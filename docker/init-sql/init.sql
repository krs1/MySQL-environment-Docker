-- データベース作成
CREATE DATABASE IF NOT EXISTS drill;
USE drill;

-- テーブル: 口座
CREATE TABLE IF NOT EXISTS 口座 (
    口座番号 CHAR(7) PRIMARY KEY,
    名義 VARCHAR(40) NOT NULL,
    種別 CHAR(1) NOT NULL,
    残高 INTEGER NOT NULL,
    更新日 DATE
);
-- テーブル: 廃止口座
CREATE TABLE IF NOT EXISTS 廃止口座 (
    口座番号 CHAR(7) PRIMARY KEY,
    名義 VARCHAR(40) NOT NULL,
    種別 CHAR(1) NOT NULL,
    解約時残高 INTEGER NOT NULL,
    解約日 DATE
);
-- テーブル: 取引事由
CREATE TABLE IF NOT EXISTS 取引事由 (
    取引事由ID INTEGER PRIMARY KEY,
    取引事由 VARCHAR(20) NOT NULL
);
-- テーブル: 取引
CREATE TABLE IF NOT EXISTS 取引 (
    取引番号 INTEGER PRIMARY KEY,
    取引事由ID INTEGER,
    日付 DATE NOT NULL,
    口座番号 CHAR(7) NOT NULL,
    入金額 INTEGER,
    出金額 INTEGER,
    FOREIGN KEY (取引事由ID) REFERENCES 取引事由(取引事由ID)
);
-- テーブル: 商品
CREATE TABLE IF NOT EXISTS 商品 (
    商品コード CHAR(5) PRIMARY KEY,
    商品名 VARCHAR(50) NOT NULL,
    単価 INTEGER NOT NULL,
    商品区分 CHAR(1) NOT NULL,
    関連商品コード CHAR(5)
);
-- テーブル: 廃番商品
CREATE TABLE IF NOT EXISTS 廃番商品 (
    商品コード CHAR(5) PRIMARY KEY,
    商品名 VARCHAR(50) NOT NULL,
    単価 INTEGER NOT NULL,
    商品区分 CHAR(1) NOT NULL,
    廃番日 DATE NOT NULL,
    売上個数 INTEGER NOT NULL
);
-- テーブル: 注文
CREATE TABLE IF NOT EXISTS 注文 (
    注文日 DATE,
    注文番号 CHAR(12),
    注文枝番 INTEGER,
    商品コード CHAR(5) NOT NULL,
    数量 INTEGER NOT NULL,
    クーポン割引料 INTEGER,
    PRIMARY KEY (注文日, 注文番号, 注文枝番)
);
-- テーブル: イベントテーブル
CREATE TABLE IF NOT EXISTS イベントテーブル (
    イベント番号 INTEGER PRIMARY KEY,
    イベント名称 VARCHAR(50) NOT NULL,
    タイプ CHAR(1) NOT NULL,
    前提イベント番号 INTEGER,
    後続イベント番号 INTEGER
);
-- テーブル: コード
CREATE TABLE IF NOT EXISTS コード (
    コード種別 INTEGER,
    コード値 CHAR(2),
    コード名称 VARCHAR(100),
    PRIMARY KEY (コード種別, コード値)
);
-- テーブル: パーティー
CREATE TABLE IF NOT EXISTS パーティー (
    ID CHAR(3) PRIMARY KEY,
    名称 VARCHAR(20) NOT NULL,
    職業コード CHAR(2) NOT NULL,
    HP INTEGER NOT NULL,
    MP INTEGER NOT NULL,
    状態コード CHAR(2) NOT NULL
);
-- テーブル: 経験イベント
CREATE TABLE IF NOT EXISTS 経験イベント (
    イベント番号 INTEGER PRIMARY KEY,
    クリア区分 CHAR(1) NOT NULL,
    クリア結果 CHAR(1),
    ルート番号 INTEGER
);

-- 初期化（テーブルのデータを削除）
SET FOREIGN_KEY_CHECKS = 0; -- 外部キー制約を一時無効化

TRUNCATE TABLE 口座;
TRUNCATE TABLE 廃止口座;
TRUNCATE TABLE 取引;
TRUNCATE TABLE 取引事由;
TRUNCATE TABLE 商品;
TRUNCATE TABLE 廃番商品;
TRUNCATE TABLE 注文;
TRUNCATE TABLE パーティー;
TRUNCATE TABLE イベントテーブル;
TRUNCATE TABLE 経験イベント;
TRUNCATE TABLE コード;

SET FOREIGN_KEY_CHECKS = 1; -- 外部キー制約を再有効化

-- INSERT INTO 口座
INSERT INTO 口座 (口座番号, 名義, 種別, 残高, 更新日) VALUES
('0037651', 'キタムラ　ユウコ', '1', 1341107, '2024-01-03'),
('0100807', 'アキタ　サトル', '3', 10000, '2022-11-30'),
('0311240', 'キムラ　タエ', '1', 63409, '2024-03-20'),
('0351333', 'アイダ　ミユ', '1', 367911, '2024-01-06'),
('0671412', 'タムラ　タカシ', '1', 678044, NULL),
('0887132', 'スギノ　ノリヨ', '1', 3491000, '2024-03-11'),
('0976410', 'タムラ　タカシ', '1', 9803, '2022-08-30'),
('1016840', 'オカダ　トシロウ', '2', 0, '2023-11-13'),
('1017119', 'ソネ　タツヤ', '1', 265000, '2023-11-26'),
('1046990', 'ツヅキ　ジュンヤ', '1', 378911, '2022-03-01'),
('1106405', 'センカワ　シゲル', '2', 5310840, '2024-03-24'),
('1115600', 'カガ　アキヨ', '1', 500000, '2023-12-28'),
('1170894', 'タムラ　タカシ', '2', 100000, '2022-04-01'),
('1193442', 'ツキシマ　ワタル', '1', 5325, '2023-01-22'),
('1217756', 'ハマダ　サトシ', '1', 1399805, '2023-03-24'),
('1234161', 'クボデラ　ヨウイチ', '1', 941670, '2024-03-23'),
('1316990', 'モリモト　ハシヤ', '1', 450980, '2023-12-30'),
('1566705', 'スエナガ　アキコ', '1', 234164, '2024-01-31'),
('1804479', 'マツモト　ミワコ', '1', 53154, '2023-03-03'),
('1840675', 'サイトウ　モモコ', '1', 0, '2024-01-10'),
('1977301', 'エガワ　サトコ', '1', 5325, '2023-02-19'),
('2004456', 'カワムラ　タツヤ', '1', 500000, '2023-12-27'),
('2086041', 'セキグチ　ショウイチロウ', '1', 4397010, '2024-01-15'),
('2094113', 'ハシモト　リョウジ', '1', 3110990, '2024-02-25'),
('2226460', 'ホリ　ミツル', '1', 904620, '2024-02-02'),
('2234108', 'サカタ　リョウヘイ', '1', 1147913, '2023-02-14'),
('2316474', 'セキ　ショウタロウ', '3', 1064497, '2023-12-02'),
('2750902', 'コイズミ　マチコ', '1', 714166, '2024-03-24'),
('2761055', 'ワダ　アキヒコ', '1', 14190, '2024-01-21'),
('3104451', 'ナカジョウ　ヨシヒコ', '2', 8136406, '2024-03-13');

-- INSERT INTO 廃止口座
INSERT INTO 廃止口座 (口座番号, 名義, 種別, 解約時残高, 解約日) VALUES
('0051432', 'オダ　シンタロウ', '1', 41310, '2023-12-24'),
('0097310', 'サイトウ　モモコ', '1', 130040, '2022-06-25'),
('0945671', 'モリシタ　カズミ', '1', 0, '2022-12-18'),
('1017100', 'ソネ　タツヤ', '1', 0, '2022-11-08');

-- INSERT INTO 取引事由
INSERT INTO 取引事由 (取引事由ID, 取引事由) VALUES
(1, '預入'),
(2, '引出'),
(3, '振込'),
(4, '通帳記入'),
(5, '残高照会'),
(6, '手数料引落'),
(9, 'その他');

-- INSERT INTO 取引
-- 取引番号の取引事由IDは19になっているが、外部キーの縛りがあるので9にする
INSERT INTO 取引 (取引番号, 取引事由ID, 日付, 口座番号, 入金額, 出金額) VALUES
(1, 9, '2022-01-05', '0051432', NULL, 41310),
(2, 1, '2022-03-01', '1017119', 65000, NULL),
(3, 2, '2022-03-01', '1046990', NULL, 19000),
(4, 5, '2022-03-01', '0945671', NULL, NULL),
(5, 1, '2022-09-03', '0887132', 1000000, NULL),
(6, 1, '2022-12-10', '0887132', 1000000, NULL),
(7, 3, '2023-06-10', '0887132', 1000000, NULL),
(8, 2, '2023-11-26', '1017119', NULL, 200000),
(9, 1, '2023-12-10', '2086041', 1164047, NULL),
(10, 3, '2023-12-10', '0887132', 491000, NULL),
(11, 1, '2023-12-25', '0037651', 30000, NULL),
(12, 2, '2023-12-28', '1115600', NULL, 100000),
(13, 3, '2023-12-28', '1115600', NULL, 120000),
(14, 6, '2023-12-28', '1115600', NULL, 256),
(15, 3, '2023-12-28', '1115600', 31500, NULL),
(16, 1, '2024-01-05', '0311240', 100000, NULL),
(17, 1, '2024-01-11', '0351333', 50000, NULL),
(18, 3, '2024-01-11', '0351333', NULL, 12600),
(19, 6, '2024-01-11', '0351333', NULL, 128),
(20, 3, '2024-01-21', '1106405', 1714930, NULL),
(21, 1, '2024-02-01', '3104451', 100000, NULL),
(22, 2, '2024-02-25', '3104451', NULL, 60000),
(23, 4, '2024-02-28', '2750902', NULL, NULL),
(24, 3, '2024-03-13', '3104451', 807310, NULL),
(25, 2, '2024-03-13', '3104451', NULL, 55000),
(26, 3, '2024-03-13', '3104451', NULL, 15100),
(27, 2, '2024-03-20', '0311240', NULL, 36591),
(28, 2, '2024-03-23', '1234161', NULL, 30000),
(29, 1, '2024-03-23', '2750902', 50000, NULL);

-- INSERT INTO 商品
INSERT INTO 商品 (商品コード, 商品名, 単価, 商品区分, 関連商品コード) VALUES
('A0001', '秋のニットスカート', 3800, '1', NULL),
('A0052', '裏起毛パーカー', 2900, '1', NULL),
('A0100', '手編みのてぶくろ', 2500, '3', 'A0101'),
('A0101', '手編みのマフラー', 3900, '3', 'A0100'),
('A0500', '透かし編みカーディガン', 5800, '1', 'A0501'),
('A0501', '透かし編みニットスカート', 7800, '1', 'A0500'),
('A1055', '刺繍ワンピース', 4500, '1', NULL),
('A6788', 'ゆるふわカットソー', 2300, '1', NULL),
('B0001', '本革ショートブーツ', 6900, '2', NULL),
('B0102', 'やわらかロングブーツ', 12600, '2', NULL),
('B0113', 'イタリア製ビジネスシューズ', 63000, '2', NULL),
('B1350', '雨の日も安心防水ブーツ', 6150, '2', NULL),
('B2137', '歩きやすいストラップシューズ', 3500, '2', NULL),
('D6402', '吸湿速乾シャツ', 590, '1', NULL),
('F0190', 'アンティーク調長財布', 12600, '3', 'F0194'),
('F0191', 'イタリアンレザー長財布', 15000, '3', NULL),
('F0194', 'アンティーク調コインケース', 8800, '3', 'F0190'),
('M0085', '本革ビジネスバッグ', 13000, '3', NULL),
('M0122', 'ニットポシェット', 3300, '3', NULL),
('M0310', '3WAYななめがけバッグ', 5000, '3', NULL),
('N0119', 'マグカップ型スピーカー', 1350, '9', NULL),
('N8810', '赤ちゃん用肌着', 980, '9', NULL),
('N8990', 'マグネット（花）', 350, '9', NULL),
('N8991', 'マグネット（雪）', 350, '9', NULL),
('N8992', 'マグネット（月）', 350, '9', NULL),
('N9999', 'テストデータ', 99999, '9', NULL),
('S0017', '形状記憶ワイシャツ', 2900, '1', NULL),
('S0023', 'チュールのコサージュ', 550, '3', NULL),
('S0604', 'さらさらキャミソール', 1300, '1', NULL),
('S0740', '長め丈Tシャツ', 1500, '1', NULL),
('S1003', '綿のジャケット', 3800, '1', NULL),
('S1056', 'サマーロングスカート', 2800, '1', NULL),
('S1074', '水玉のワンピース', 2600, '1', NULL),
('W0012', 'ニットセーター', 3500, '1', NULL),
('W0156', 'あったかルームソックス', 800, '1', 'W0746'),
('W0746', 'あったかルームウェアセット', 3500, '1', 'W0156'),
('W0960', '毛皮のコート', 58000, '1', NULL),
('W1252', '薄くて軽いダウンジャケット', 5200, '1', NULL),
('Z2323', 'ハンカチ（水玉）', 300, '3', NULL),
('Z2324', 'ハンカチ（チェック）', 300, '3', NULL),
('Z3360', 'あったかタイツ', 500, '1', NULL),
('Z6511', '丈夫な靴下', 600, '1', NULL);

-- INSERT INTO 廃番商品
INSERT INTO 廃番商品 (商品コード, 商品名, 単価, 商品区分, 廃番日, 売上個数) VALUES
('A0009', '麻のパンツ', 7500, '1', '2023-08-31', 14),
('A0931', '時代遅れのジャケット', 7800, '1', '2010-07-05', 161),
('B0090', 'ヒール役のハイヒール', 8900, '2', '2022-12-01', 75),
('N0223', 'ばねのおもちゃ（きりん）', 630, '9', '2022-12-01', 88),
('N0501', 'ばねのおもちゃ（かもしか）', 630, '9', '2022-12-01', 55),
('N1021', 'ばねのおもちゃ（しまうま）', 630, '9', '2022-12-01', 65),
('S1990', 'ラップスカート', 6800, '1', '2023-02-10', 18),
('Z8980', 'ハンカチ（ペイズリー）', 300, '3', '2022-11-30', 56),
('Z8981', 'ハンカチ（しましま）', 400, '3', '2024-10-08', 5);


-- INSERT INTO 注文
INSERT INTO 注文 (注文日, 注文番号, 注文枝番, 商品コード, 数量, クーポン割引料) VALUES
('2022-04-12', '202204120003', 1, 'S0604', 1, NULL),
('2022-05-03', '202205030011', 1, 'S0604', 2, NULL),
('2022-07-07', '202207070005', 1, 'S0604', 5, 500),
('2022-07-21', '202207210022', 1, 'D6402', 2, NULL),
('2022-07-21', '202207210022', 2, 'N0223', 1, NULL),
('2022-08-01', '202208010493', 1, 'N0501', 1, NULL),
('2022-08-03', '202208030006', 1, 'A6788', 1, NULL),
('2022-08-12', '202208120047', 1, 'D6402', 3, NULL),
('2022-08-18', '202208180338', 1, 'N8810', 5, 150),
('2022-10-01', '202210010561', 1, 'N1021', 1, NULL),
('2023-04-02', '202304020841', 1, 'S0331', 1, NULL),
('2023-04-03', '202304030010', 1, 'M0310', 1, NULL),
('2023-04-03', '202304030010', 2, 'S1074', 1, NULL),
('2023-04-03', '202304030010', 3, 'A0009', 1, NULL),
('2023-06-06', '202306060061', 1, 'B1350', 1, 600),
('2023-06-18', '202306180180', 1, 'S0604', 10, 1000),
('2023-07-01', '202307010019', 1, 'A0009', 1, NULL),
('2023-08-08', '202308080013', 1, 'S0604', 3, NULL),
('2023-09-03', '202309030121', 1, 'B0001', 1, NULL),
('2023-09-09', '202309090008', 1, 'A0009', 1, NULL),
('2023-09-10', '202309100066', 1, 'A0009', 2, NULL),
('2023-09-15', '202309150031', 1, 'M0122', 1, NULL),
('2023-09-15', '202309150031', 2, 'W0746', 1, NULL),
('2023-09-23', '202309230045', 1, 'W0746', 2, NULL),
('2023-09-25', '202309250031', 1, 'A0001', 1, NULL),
('2023-09-25', '202309250046', 1, 'A0001', 1, 100),
('2023-10-01', '202310010171', 1, 'W0746', 1, NULL),
('2023-10-10', '202310100474', 1, 'A0500', 1, NULL),
('2023-10-15', '202310150061', 1, 'F0194', 1, NULL),
('2023-10-19', '202310190940', 1, 'W0461', 1, 1000),
('2023-10-22', '202310220047', 1, 'W0156', 3, 350),
('2023-10-30', '202310300045', 1, 'B2137', 1, NULL),
('2023-10-30', '202310300045', 2, 'W0156', 1, NULL),
('2023-10-30', '202310300045', 3, 'Z3360', 3, NULL),
('2023-11-02', '202311027410', 1, 'W0746', 1, 1000),
('2023-11-24', '202311240200', 1, 'Z2323', 150, NULL),
('2023-11-24', '202311240200', 2, 'Z6511', 150, NULL),
('2023-11-24', '202311241999', 1, 'M0122', 1, NULL),
('2023-11-24', '202311241999', 2, 'A1055', 1, NULL),
('2023-12-01', '202312010470', 1, 'B0102', 1, NULL),
('2023-12-01', '202312010505', 1, 'N8810', 3, NULL),
('2023-12-01', '202312120505', 2, 'N8990', 6, NULL),
('2023-12-05', '202312056101', 1, 'W0746', 1, 600),
('2023-12-12', '202312120008', 1, 'Z2324', 16, NULL),
('2023-12-12', '202312120009', 1, 'N0119', 1, NULL),
('2023-12-18', '202312180015', 1, 'N0223', 23, NULL),
('2023-12-18', '202312180054', 1, 'S0017', 2, 200),
('2023-12-31', '202312310011', 1, 'W1252', 1, NULL),
('2024-01-03', '202401030310', 1, 'Z6511', 2, NULL),
('2024-01-03', '202401030310', 2, 'W0012', 1, NULL),
('2024-01-10', '202401100015', 1, 'B0102', 1, 500),
('2024-01-13', '202401130115', 1, 'F0190', 1, 500),
('2024-01-13', '202401130115', 2, 'F0194', 1, 500),
('2024-01-13', '202401130115', 3, 'A1055', 1, 500),
('2024-02-25', '202402250126', 1, 'A0100', 1, NULL),
('2024-02-25', '202402250126', 2, 'W0156', 2, NULL),
('2024-03-01', '202403014050', 1, 'S0331', 1, NULL),
('2024-03-09', '202403090024', 1, 'S0331', 1, NULL),
('2024-03-09', '202403090024', 2, 'Z6511', 5, NULL),
('2024-03-09', '202403090024', 3, 'S0740', 1, NULL),
('2024-03-12', '202403120001', 1, 'W0012', 2, 200),
('2024-03-13', '202403130207', 1, 'D6402', 3, NULL),
('2024-03-14', '202403141004', 1, 'B0102', 1, NULL),
('2024-03-14', '202403141004', 2, 'Z6511', 3, 300),
('2024-03-15', '202403150014', 1, 'B0113', 1, NULL),
('2024-03-21', '202403210080', 1, 'M0310', 1, NULL),
('2024-03-22', '202403220901', 1, 'S0331', 1, NULL),
('2024-03-22', '202403220901', 2, 'A6788', 1, NULL);

-- INSERT INTO パーティー
INSERT INTO パーティー (ID, 名称, 職業コード, HP, MP, 状態コード) VALUES
('C01', 'ミナト', '01', 89, 35, '00'),
('C02', 'アサカ', '11', 74, 66, '00');

-- INSERT INTO イベントテーブル
INSERT INTO イベントテーブル (イベント番号, イベント名称, タイプ, 前提イベント番号, 後続イベント番号) VALUES
(1, 'オープニング', '1', NULL, 3),
(2, 'オープニング（2週目以降）', '3', NULL, 3),
(3, '勇者の旅立ち', '1', NULL, 4),
(4, '初めての仲間', '1', 3, 5),
(5, '盗賊ダンシーを追え！', '1', 4, 7),
(6, '宝石の洞窟', '2', NULL, NULL),
(7, 'イガヤの町の秘密', '1', 5, 9),
(8, '妖精の森の下で', '2', NULL, NULL),
(9, '潜入！バクロック城', '1', 7, 10),
(10, '師との出会い', '1', 9, 12),
(11, '隠れ里ボウジーン', '2', NULL, NULL),
(12, 'ドウンブリッジの戦い', '1', 10, 15),
(13, '名誉を賭して', '2', NULL, 18),
(14, 'ナボーリ火山と三つの島', '2', NULL, NULL),
(15, '水の洞窟に潜むもの', '1', 12, 17),
(16, '盗賊ダンシーの依頼', '2', 5, NULL),
(17, '封印の町ノザ', '1', 15, 22),
(18, '聖騎士の涙', '2', 13, NULL),
(19, '賢者の婚姻', '2', 17, NULL),
(20, '王位継承者の帰郷', '2', 17, NULL),
(21, '新大陸の魔女', '2', 17, NULL),
(22, 'それぞれの願いのために', '1', 17, 23),
(23, '最終決戦', '1', 22, 24),
(24, 'そして世界のはじまりに', '1', 23, NULL),
(25, 'エンディング', '1', 24, NULL),
(26, 'エンディング（2週目以降）', '3', 24, NULL);

-- INSERT INTO 経験イベント
INSERT INTO 経験イベント (イベント番号, クリア区分, クリア結果, ルート番号) VALUES
(1, '1', 'A', 1),
(3, '1', 'B', 2),
(4, '1', 'A', 3),
(5, '1', 'B', 4),
(6, '1', 'C', 5),
(7, '1', 'B', 6),
(9, '0', NULL, NULL);

-- INSERT INTO コード
-- (1, '14', '魔剣士'), が重複しているので修正
INSERT INTO コード (コード種別, コード値, コード名称) VALUES
(1, '01', '勇者'),
(1, '10', '戦士'),
(1, '11', '武道家'),
(1, '12', '忍者'),
(1, '13', '聖騎士'),
(1, '14', '竜騎士'),
(1, '15', '魔剣士'),
(1, '20', '魔法使い'),
(1, '21', '学者'),
(1, '22', '僧侶'),
(1, '23', '賢者'),
(1, '24', '踊り子'),
(1, '25', '吟遊詩人'),
(2, '00', '異常なし'),
(2, '01', '眠り'),
(2, '02', '毒'),
(2, '03', '沈黙'),
(2, '04', '混乱'),
(2, '09', '気絶'),
(3, '01', '強制'),
(3, '02', 'フリー'),
(3, '03', '特殊'),
(4, 'A', 'たいへんよくできました'),
(4, 'B', 'よくできました'),
(4, 'C', 'もう少し頑張りましょう'),
(4, 'X', '判定不能');
